"use strict";var e,r=require("devfractal-router"),t=(e=require("react"))&&"object"==typeof e&&"default"in e?e.default:e,n=require("technoidentity-utils"),o=function(){return t.createElement("h1",{className:"is-text is-size-1 is-info"},"Loading....")},i=function(e){return t.createElement("h1",{className:"is-text is-size-1 is-danger"},e.error.message)};function c(){return(c=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function u(e,r,n){var o=t.useState(void 0),i=o[1];return{serverError:o[0],onClick:function(){try{return Promise.resolve(e().then(r).catch(function(e){if(e&&e.response&&e.response.data)i(e.response.data.error),n&&n(e);else{if(!n)throw e;n(e)}}))}catch(e){return Promise.reject(e)}}}}function s(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var i=t.useState(void 0),u=i[0],s=i[1],a=t.useState(void 0),l=a[0],m=a[1],f=t.useState(!1),d=f[0],v=f[1],p=t.useState(0),E=p[0],h=p[1],g=t.useRef(!1);return t.useEffect(function(){return v(!0),g.current=!0,e.apply(void 0,n).then(function(e){g.current&&(v(!1),s(e),m(void 0))}).catch(function(e){g.current&&(v(!1),m(e))}),function(){g.current=!1}},[].concat(n,[E])),c({refresh:function(){return h(function(e){return(e+1)%100})}},u?{state:"success",data:u}:l?{state:"failure",error:l}:{state:d?"loading":"none"})}function a(e){var r=e.deps,n=e.component,c=e.children,u=s.apply(void 0,[e.asyncFn].concat(void 0===r?[]:r));if("failure"===u.state)return t.createElement(i,{error:u.error});if("success"===u.state){if(n)return t.createElement(n,{data:u.data,fetchAgain:u.refresh});if(c)return c(u.data,u.refresh);throw new Error("component or children must be provided to Get")}return t.createElement(o,null)}var l=n.string,m=n.readonlyArray(n.string),f=n.recursion("ValidationErrors",function(){return n.record(n.string,n.union([l,m,f]))}),d=n.union([n.string,l,m,f]),v=function(e){var r=e.error;return t.createElement(t.Fragment,null,r&&t.createElement("article",{className:"message is-danger"},t.createElement("div",{className:"message-body"},function e(r){return n.cast(d,r),n.string.is(r)?r:l.is(r)?r:m.is(r)?r.join("\n"):f.is(r)?n.keys(r.validationErrors).map(function(t){return t+": "+e(r.validationErrors[t])}).join("\n"):"FATAL: unknown server error"}(r))))};function p(e,r,n){var o=t.useState(void 0),i=o[1];return{serverError:o[0],onSubmit:function(t,o){try{return Promise.resolve(e(t).then(function(e){return r(e,o)}).catch(function(e){if(e&&e.response&&e.response.data)i(e.response.data.error),n&&n(e,o);else{if(!n)throw e;n(e,o)}}).finally(function(){return o.setSubmitting(!1)}))}catch(e){return Promise.reject(e)}}}}function E(){var e=r.useHistory();return{onRedirect:function(r){r&&e.push(r)}}}function h(e,r){var t=E().onRedirect;return p(e,function(){return t(r)})}function g(e,r){return p(e,function(e,t){t.setValues(e),r||t.resetForm()})}exports.Del=function(e){var r=e.onDel,n=e.onSuccess,o=e.children,i=function(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r.indexOf(t=i[n])>=0||(o[t]=e[t]);return o}(e,["onDel","onSuccess","children"]),c=u(r,n),s=c.serverError,a=c.onClick;return t.createElement(t.Fragment,null,s&&t.createElement("div",{className:"toast"},s),t.createElement("button",Object.assign({},i,{onClick:a}),o))},exports.ErrorView=i,exports.Get=a,exports.Loading=o,exports.NotFound=function(){var e=r.useRouter();return t.createElement("h1",null,"path "+e.location.pathname+" did not match any route")},exports.Patch=function(e){var r=e.id,n=e.doGet,o=e.onPatch,i=e.component,c=h(function(e){try{return Promise.resolve(o(r,e))}catch(e){return Promise.reject(e)}},e.redirectTo),u=c.onSubmit;return t.createElement(t.Fragment,null,t.createElement(v,{error:c.serverError}),t.createElement(a,{asyncFn:n,deps:[r]},function(e){return t.createElement(i,{initial:e,onSubmit:u})}))},exports.PatchReset=function(e){var r=e.id,n=e.doGet,o=e.onPatch,i=e.component,c=g(function(e){try{return Promise.resolve(o(r,e))}catch(e){return Promise.reject(e)}}),u=c.onSubmit;return t.createElement(t.Fragment,null,t.createElement(v,{error:c.serverError}),t.createElement(a,{asyncFn:n,deps:[r]},function(e){return t.createElement(i,{initial:e,onSubmit:u})}))},exports.Post=function(e){var r=e.component,n=h(e.onPost,e.redirectTo),o=n.onSubmit;return t.createElement(t.Fragment,null,t.createElement(v,{error:n.serverError}),t.createElement(r,{onSubmit:o}))},exports.PostReset=function(e){var r=e.component,n=g(e.onPost),o=n.onSubmit;return t.createElement(t.Fragment,null,t.createElement(v,{error:n.serverError}),t.createElement(r,{onSubmit:o}))},exports.Put=function(e){var r=e.id,n=e.doGet,o=e.onPut,i=e.component,c=h(function(e){try{return Promise.resolve(o(r,e))}catch(e){return Promise.reject(e)}},e.redirectTo),u=c.onSubmit;return t.createElement(t.Fragment,null,t.createElement(v,{error:c.serverError}),t.createElement(a,{asyncFn:n,deps:[r]},function(e){return t.createElement(i,{initial:e,onSubmit:u})}))},exports.PutReset=function(e){var r=e.id,n=e.doGet,o=e.onPut,i=e.component,c=g(function(e){try{return Promise.resolve(o(r,e))}catch(e){return Promise.reject(e)}}),u=c.onSubmit;return t.createElement(t.Fragment,null,t.createElement(v,{error:c.serverError}),t.createElement(a,{asyncFn:n,deps:[r]},function(e){return t.createElement(i,{initial:e,onSubmit:u})}))},exports.ServerError=v,exports.useDel=u,exports.useGet=s,exports.useRedirect=E,exports.useSubmit=p,exports.useSubmitRedirect=h,exports.useSubmitReset=g;
//# sourceMappingURL=devfractal-ui-api.cjs.production.min.js.map
